
/*********************************************************************
	SYSTEM MonsterCatcher
	IMPLEMENTATION MCArduino
	Module for CIP MACHINE mMCUNit
	Filename: mMCUNit.c
	generated by CIP Tool(R) Version 4.41.00
		August 23, 2012  9:16:07 pm
	activated code options:
		PENDING_ information
		'unsigned char' for 'enum'
		C-code
*********************************************************************/

/* Include Files */

#include "mMCUNit.h"

/* External Declarations */

void fICHAN_BedDetectorChannel (unsigned char name_);
void fICHAN_ObstacleDetection (unsigned char name_);
void fICHAN_WanderChannel (unsigned char name_);
void fINIT_Avoid (void);
void fINIT_BedDetector (void);
void fINIT_Catcher (void);
void fINIT_Drive (void);
void fINIT_DrunkDrive (void);
void fINIT_Finder (void);
void fINIT_Wander (void);

/* Global Declarations */

unsigned long time_mMCUNit = 0;
union tCHNOUT_mMCUNit CHNOUT_mMCUNit;
struct tTIMING_mMCUNit TIMING_mMCUNit[4];
struct tTMQE_mMCUNit *tuhead_mMCUNit, *tutail_mMCUNit;

/* Function Prototypes */

void fSETTIM_mMCUNit (unsigned long *delay_, struct tTMEL_mMCUNit *timer_, struct tTMQE_mMCUNit *timeup_);
void fSTOPTIM_mMCUNit (struct tTMEL_mMCUNit *timer_, struct tTMQE_mMCUNit *timeup_);
void fSTEP_mMCUNit(void);
void fCHAIN_mMCUNit(void);
void fTIMEUP_mMCUNit(void);
void fREAD_mMCUNit(void);
void fUPDATE_Body (void);

/* AUTO_ Handler Function */

static void fAUTOHDL_mMCUNit(void)
{
		/* dummy function handling no AUTO_ */
}

/* Timer Functions */

static void fTICK_mMCUNit(void)
{
	int i_;
	time_mMCUNit ++;
	for (i_ = 0; i_ < 4; i_ ++)
		if (TIMING_mMCUNit[i_].set_)
			TIMING_mMCUNit[i_].tkhndl_ ();
	TRG_.PENDING_.TIMEUP_ = tuhead_mMCUNit != 0;
	TRG_.PENDING_.ANY_ = TRG_.PENDING_.ANY_ || TRG_.PENDING_.TIMEUP_;
}

void fSETTIM_mMCUNit (unsigned long *delay_, struct tTMEL_mMCUNit *timer_, struct tTMQE_mMCUNit *timeup_)
{
	if (*delay_ > 0)
	{
		if (! timer_->set_)
			++TIMING_mMCUNit[timeup_->proctype_].set_;
		timer_->set_ = TRUE;
		timer_->end_ = time_mMCUNit + *delay_;
		if (tuhead_mMCUNit == timeup_)
			tuhead_mMCUNit = tuhead_mMCUNit->next_;
		if (timeup_->preced_)
			timeup_->preced_->next_ = timeup_->next_;
		if (timeup_->next_)
			timeup_->next_->preced_ = timeup_->preced_;
		if (tutail_mMCUNit == timeup_)
			tutail_mMCUNit = timeup_->preced_;
		timeup_->preced_ = 0;
		timeup_->next_ = 0;
	}
	else 
	{
		if (timer_->set_)
			--TIMING_mMCUNit [timeup_->proctype_].set_;
		timer_->set_ = FALSE;
		if (tuhead_mMCUNit != timeup_ && ! timeup_->preced_ && ! timeup_->next_)
		{
			if (! tuhead_mMCUNit)
				tuhead_mMCUNit = tutail_mMCUNit = timeup_;
			else 
			{
				tutail_mMCUNit->next_ = timeup_;
				timeup_->preced_ = tutail_mMCUNit;
				tutail_mMCUNit = timeup_;
			}
		}
	}
}

void fSTOPTIM_mMCUNit (struct tTMEL_mMCUNit *timer_, struct tTMQE_mMCUNit *timeup_)
{
	if (timer_->set_)
		--TIMING_mMCUNit [timeup_->proctype_].set_;
	timer_->set_ = FALSE;
	if (tuhead_mMCUNit == timeup_)
		tuhead_mMCUNit = tuhead_mMCUNit->next_;
	if (timeup_->preced_)
		timeup_->preced_->next_ = timeup_->next_;
	if (timeup_->next_)
		timeup_->next_->preced_ = timeup_->preced_;
	if (tutail_mMCUNit == timeup_)
		tutail_mMCUNit = timeup_->preced_;
	timeup_->preced_ = 0;
	timeup_->next_ = 0;
}

/* Control Functions */

	/* Step Function for CIP Machine */

void fSTEP_mMCUNit(void)
{
	if (tuhead_mMCUNit != 0)
		TIMING_mMCUNit[tuhead_mMCUNit->proctype_].tuhndl_ ();
	return;
}

	/* Chain Function for CIP Machine */

void fCHAIN_mMCUNit(void)
{
	return;
}

	/* Timeup Function for CIP Machine */

void fTIMEUP_mMCUNit(void)
{
	if (tuhead_mMCUNit != 0)
		TIMING_mMCUNit [tuhead_mMCUNit->proctype_].tuhndl_ ();
	return;
}

	/* Read Function for CIP Machine */

void fREAD_mMCUNit(void)
{
	return;
}

/* Update Functions */

void fUPDATE_Body (void)
{
	TRG_.PENDING_.TIMEUP_ = tuhead_mMCUNit != 0;
	TRG_.PENDING_.ANY_ = 
		TRG_.PENDING_.TIMEUP_;
}

/* Initialization Function */

int fINIT_(void)
{
	tuhead_mMCUNit = tutail_mMCUNit = 0;
	TRG_.TICK_ = fTICK_mMCUNit;
	TRG_.CHAIN_ = fCHAIN_mMCUNit;
	TRG_.TIMEUP_ = fTIMEUP_mMCUNit;
	TRG_.STEP_ = fSTEP_mMCUNit;
	TRG_.READ_ = fREAD_mMCUNit;
	TRG_.AUTO_ = fAUTOHDL_mMCUNit;
	TRG_.PENDING_.ANY_ = 0;
	TRG_.PENDING_.CHAIN_ = 0;
	TRG_.PENDING_.TIMEUP_ = 0;
	TRG_.PENDING_.READ_ = 0;
	TRG_.PENDING_.AUTO_ = 0;
	IN_.BedDetectorChannel = fICHAN_BedDetectorChannel;
	IN_.ObstacleDetection = fICHAN_ObstacleDetection;
	IN_.WanderChannel = fICHAN_WanderChannel;
	iCHAN_();
	if (!OUT_.DriveChannel)
		return 0;
	if (!OUT_.CatcherChannel)
		return 0;
	fINIT_Avoid ();
	fINIT_BedDetector ();
	fINIT_Catcher ();
	fINIT_Drive ();
	fINIT_DrunkDrive ();
	fINIT_Finder ();
	fINIT_Wander ();
	return 1;
}

/*********************************************************************
	End of Module for CIP MACHINE mMCUNit
*********************************************************************/
